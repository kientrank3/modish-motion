<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kết quả tìm kiếm</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            background: #fff;
            z-index: 40;
            border-bottom: 1px solid #eee;
        }

        .category-controls {
            position: sticky;
            top: 64px; /* Adjust this value to match the height of the header */
            background: #fff;
            z-index: 30;
            border-bottom: 1px solid #eee;
            padding: 12px 0;
            transition: all 0.3s ease;
        }

        .category-controls.fixed {
            position: fixed;
            left: 0;
            right: 0;
            top: 0;
            z-index: 50; /* Ensure it is above the header */
        }

        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            min-width: 160px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        @media (max-width: 1024px) {
            .product-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .product-grid {
                grid-template-columns: repeat(1, 1fr);
            }
        }

        #sideMenu {
            padding: 0 1rem;
        }

        @media (min-width: 1024px) {
            #sideMenu {
                padding: 0 1.5rem;
            }
        }
    </style>
</head>
<body class="bg-white">
<header th:replace="components/header :: header"></header>

<main class="pt-16">
    <div class="container mx-auto px-4 lg:px-6">
        <h1 class="text-2xl font-semibold text-[#31495e] mb-4">
            Kết quả tìm kiếm cho
        </h1>
        <h2 class="text-xl text-[#31495e] mb-2" th:text="${searchQuery}"></h2>

        <div class="category-controls" id="categoryControls">
            <div class="container mx-auto px-4 lg:px-6">
                <div class="flex justify-between items-center">
                    <span class="text-[#31495e] text-sm" th:text="${items.size()} + ' sản phẩm'">335 sản phẩm</span>
                    <div class="flex gap-3">
                        <div class="dropdown relative">
                            <button class="px-4 py-2 border border-gray-200 rounded-lg text-sm text-[#31495e] hover:border-[#31495e] transition-colors flex items-center gap-2">
                                Danh sách
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 9l6 6 6-6"/>
                                </svg>
                            </button>
                            <div class="dropdown-content">
                                <a href="#" class="block px-4 py-2 text-sm text-[#31495e] hover:bg-gray-100" onclick="sortItems('newest')">Mới nhất</a>
                                <a href="#" class="block px-4 py-2 text-sm text-[#31495e] hover:bg-gray-100" onclick="sortItems('bestselling')">Bán chạy</a>
                                <a href="#" class="block px-4 py-2 text-sm text-[#31495e] hover:bg-gray-100" onclick="sortItems('priceAsc')">Giá thấp đến cao</a>
                                <a href="#" class="block px-4 py-2 text-sm text-[#31495e] hover:bg-gray-100" onclick="sortItems('priceDesc')">Giá cao đến thấp</a>
                            </div>
                        </div>
                        <button onclick="openFilter()"
                                class="px-4 py-2 border border-gray-200 rounded-lg text-sm text-[#31495e] hover:border-[#31495e] transition-colors flex items-center gap-2">
                            Bộ lọc
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M6 9l6 6 6-6"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6 py-6 justify-items-center" id="productGrid">
            <!-- Product Items -->
            <th:block th:each="item : ${items}">
                <div th:replace="components/productItem :: productItem(${item})" class="w-full"></div>
            </th:block>
        </div>

<!--        <div class="text-[#31495e] space-y-4 pb-12">-->
<!--            &lt;!&ndash; ...existing code... &ndash;&gt;-->
<!--        </div>-->
    </div>
</main>

<th:block th:replace="~{filter :: filter}"></th:block>
<script th:src="@{/js/filter.js}"></script>
<script>
    // Category Controls Sticky Behavior
    const categoryControls = document.getElementById('categoryControls');
    const header = document.querySelector('header');
    const headerHeight = header.offsetHeight;
    let lastScroll = 0;

    window.addEventListener('scroll', () => {
        const currentScroll = window.pageYOffset;

        if (currentScroll > headerHeight) {
            if (currentScroll > lastScroll) {
                // Scrolling down
                categoryControls.classList.add('fixed');
                categoryControls.style.top = '0';
                categoryControls.style.zIndex = '50';
            } else {
                // Scrolling up
                categoryControls.classList.remove('fixed');
                categoryControls.style.top = '64px'; // Adjust this value to match the height of the header
                categoryControls.style.zIndex = '30';
            }
        } else {
            categoryControls.classList.remove('fixed');
            categoryControls.style.top = '64px'; // Adjust this value to match the height of the header
            categoryControls.style.zIndex = '30';
        }

        lastScroll = currentScroll;
    });

    // Description Toggle
    function toggleDescription() {
        const description = document.getElementById('description');
        const toggleText = document.getElementById('toggleText');
        const toggleIcon = document.getElementById('toggleIcon');

        description.classList.toggle('max-h-24');
        if (description.classList.contains('max-h-24')) {
            toggleText.textContent = 'Xem thêm';
            toggleIcon.style.transform = 'rotate(0deg)';
        } else {
            toggleText.textContent = 'Thu gọn';
            toggleIcon.style.transform = 'rotate(180deg)';
        }
    }

    function openFilter() {
        const overlay = document.getElementById('filterOverlay');
        const panel = document.getElementById('filterPanel');

        overlay.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        requestAnimationFrame(() => {
            panel.classList.remove('translate-y-full');
        });
    }

    async function loadMore(page, categoryName) {
        try {
            const response = await fetch(`/categories/${categoryName}?page=${page}`);
            const data = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(data, 'text/html');
            const newItems = doc.querySelectorAll('#productGrid > div');
            const productGrid = document.getElementById('productGrid');
            newItems.forEach(item => productGrid.appendChild(item));
            if (page >= totalPages - 1) {
                document.querySelector('button[onclick^="loadMore"]').style.display = 'none';
            }
        } catch (error) {
            console.error('Error loading more items:', error);
        }
    }

    function sortItems(sortBy) {
        const urlParams = new URLSearchParams(window.location.search);
        urlParams.set('sortBy', sortBy);
        window.location.search = urlParams.toString();
    }
</script>
</body>
</html>
