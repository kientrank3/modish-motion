<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<div th:fragment="filter"
     class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 transition-opacity duration-300 hidden"
     id="filterOverlay">
    <div class="fixed bottom-0 left-0 right-0 bg-white rounded-t-2xl transform translate-y-full transition-transform duration-300"
         id="filterPanel"
         style="max-height: 90vh; overflow-y: auto;">
        <!-- Close Button -->
        <button onclick="closeFilter()" class="absolute top-4 right-4 bg-black text-white rounded-full p-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        <!-- Filter Content -->
        <div class="container mx-auto px-4 py-6">
            <!-- Colors Section -->
            <div class="mb-8">
                <h3 class="text-lg font-medium text-[#31495e] mb-4">Màu sắc</h3>
                <div class="flex flex-wrap gap-4" th:if="${groupedColors != null}">
                    <div th:each="colorGroup : ${groupedColors}" class="text-center">
                        <input type="checkbox"
                               th:id="${'color-' + colorGroup.key}"
                               th:name="colors"
                               th:value="${colorGroup.key}"
                               class="hidden"
                               th:data-color="${colorGroup.key}">
                        <label th:for="${'color-' + colorGroup.key}"
                               class="flex flex-col items-center gap-2 cursor-pointer">
                            <span class="w-8 h-8 rounded-full border border-gray-200 transition-transform hover:scale-110"
                                  th:style="${'background-color: ' + colorGroup.key}"></span>
                            <span class="text-sm text-[#31495e]" th:text="${colorGroup.key}">Màu</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Sizes Section -->
            <div class="mb-8">
                <h3 class="text-lg font-medium text-[#31495e] mb-4">Kích thước</h3>
                <div class="grid grid-cols-3 gap-4" th:if="${groupedSizes != null}">
                    <div th:each="sizeGroup : ${groupedSizes}">
                        <input type="checkbox"
                               th:id="${'size-' + sizeGroup.key}"
                               th:name="sizes"
                               th:value="${sizeGroup.key}"
                               class="hidden">
                        <label th:for="${'size-' + sizeGroup.key}"
                               class="block w-full py-2 text-center border border-gray-200 rounded-lg text-[#31495e] cursor-pointer hover:border-[#31495e] transition-colors">
                            <span th:text="${sizeGroup.key}">Size</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Price Range Section -->
            <div class="mb-8">
                <h3 class="text-lg font-medium text-[#31495e] mb-4">Theo giá</h3>
                <div class="space-y-3">
                    <div class="flex items-center">
                        <input type="radio"
                               id="price-1"
                               name="price-range"
                               value="0-350000"
                               class="hidden">
                        <label for="price-1"
                               class="flex items-center gap-2 text-[#31495e] cursor-pointer">
                            <span class="w-4 h-4 border border-gray-300 rounded-full flex items-center justify-center">
                                <span class="w-2 h-2 bg-[#31495e] rounded-full hidden"></span>
                            </span>
                            Dưới 350.000đ
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio"
                               id="price-2"
                               name="price-range"
                               value="350000-750000"
                               class="hidden">
                        <label for="price-2"
                               class="flex items-center gap-2 text-[#31495e] cursor-pointer">
                            <span class="w-4 h-4 border border-gray-300 rounded-full flex items-center justify-center">
                                <span class="w-2 h-2 bg-[#31495e] rounded-full hidden"></span>
                            </span>
                            Từ 350.000đ - 750.000đ
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio"
                               id="price-3"
                               name="price-range"
                               value="750000-999999999"
                               class="hidden">
                        <label for="price-3"
                               class="flex items-center gap-2 text-[#31495e] cursor-pointer">
                            <span class="w-4 h-4 border border-gray-300 rounded-full flex items-center justify-center">
                                <span class="w-2 h-2 bg-[#31495e] rounded-full hidden"></span>
                            </span>
                            Trên 750.000đ
                        </label>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4 sticky bottom-0 bg-white py-4 border-t">
                <button onclick="clearFilters()"
                        class="flex-1 py-3 px-4 border border-gray-200 rounded-lg text-[#31495e] hover:bg-gray-50 transition-colors">
                    Xóa bộ lọc
                </button>
                <button onclick="applyFilters()"
                        class="flex-1 py-3 px-4 bg-[#ffd800] rounded-lg text-[#31495e] hover:bg-[#ffd800]/90 transition-colors">
                    Áp dụng
                </button>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    function openFilter() {
        const overlay = document.getElementById('filterOverlay');
        const panel = document.getElementById('filterPanel');

        overlay.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        requestAnimationFrame(() => {
            panel.classList.remove('translate-y-full');
        });
    }

    function closeFilter() {
        const overlay = document.getElementById('filterOverlay');
        const panel = document.getElementById('filterPanel');

        panel.classList.add('translate-y-full');
        document.body.style.overflow = '';
        setTimeout(() => {
            overlay.classList.add('hidden');
        }, 300);
    }

    function clearFilters() {
        // Clear all checkboxes and radio buttons
        document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(input => {
            input.checked = false;
        });
    }

    function applyFilters() {
        // Collect selected filters
        const selectedColors = Array.from(document.querySelectorAll('input[name="colors"]:checked'))
            .map(input => input.value);
        const selectedSizes = Array.from(document.querySelectorAll('input[name="sizes"]:checked'))
            .map(input => input.value);
        const selectedPriceRange = document.querySelector('input[name="price-range"]:checked')?.value;

        // Build query parameters
        const params = new URLSearchParams(window.location.search);
        if (selectedColors.length) params.set('colors', selectedColors.join(','));
        if (selectedSizes.length) params.set('sizes', selectedSizes.join(','));
        if (selectedPriceRange) params.set('priceRange', selectedPriceRange);

        // Redirect with filters
        window.location.href = `${window.location.pathname}?${params.toString()}`;
    }

    // Style radio buttons
    document.querySelectorAll('input[type="radio"]').forEach(radio => {
        radio.addEventListener('change', function() {
            // Hide all dots
            document.querySelectorAll('input[type="radio"] + label span span').forEach(dot => {
                dot.classList.add('hidden');
            });
            // Show dot for checked radio
            if (this.checked) {
                this.nextElementSibling.querySelector('span span').classList.remove('hidden');
            }
        });
    });

    // Close filter when clicking outside
    document.getElementById('filterOverlay').addEventListener('click', function(event) {
        if (event.target === this) {
            closeFilter();
        }
    });

    // Close filter when clicking outside the panel
    document.getElementById('filterPanel').addEventListener('click', function(event) {
        event.stopPropagation();
    });
</script>
</html>